resource "google_storage_bucket" "basic_bucket" {
  name          = "dataplex-bucket-%{random_suffix}"
  location      = "us-central1"
  uniform_bucket_level_access = true
  lifecycle {
    ignore_changes = [
      labels
    ]
  }

  project = "<%= ctx[:test_env_vars]['project_name'] %>"
}

resource "google_dataplex_lake" "basic_lake" {
  name         = "lake"
  location     = "us-central1"
  project = "<%= ctx[:test_env_vars]['project_name'] %>"
}


resource "google_dataplex_zone" "basic_zone" {
  name         = "zone"
  location     = "us-central1"
  lake = google_dataplex_lake.basic_lake.name
  type = "RAW"

  discovery_spec {
    enabled = false
  }


  resource_spec {
    location_type = "SINGLE_REGION"
  }

  project = "<%= ctx[:test_env_vars]['project_name'] %>"
}



resource "google_dataplex_asset" "<%= ctx[:primary_resource_id] %>" {
  name          = "<%= ctx[:vars]["name"] %>"
  location      = "us-central1"

  lake = google_dataplex_lake.basic_lake.name
  dataplex_zone = google_dataplex_zone.basic_zone.name

  discovery_spec {
    enabled = false
  }

  resource_spec {
    name = "projects/<%= ctx[:test_env_vars]['project_name'] %>/buckets/dataplex-bucket-%{random_suffix}"
    type = "STORAGE_BUCKET"
  }

  project = "<%= ctx[:test_env_vars]['project_name'] %>"
  depends_on = [
    google_storage_bucket.basic_bucket
  ]
}

